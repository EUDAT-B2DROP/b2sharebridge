(()=>{"use strict";var e,t={3510:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(1354),r=n.n(o),s=n(6314),a=n.n(s)()(r());a.push([e.id,".bridgetoken[data-v-20ea2ead]{border-bottom:1px solid var(--color-border)}.bridgetoken__fields[data-v-20ea2ead]{max-width:600px;margin-bottom:10px}.bridgetoken__fields__buttons[data-v-20ea2ead]{display:flex;flex-direction:column;align-items:end}","",{version:3,sources:["webpack://./src/components/TokenEditor.vue"],names:[],mappings:"AACA,8BACC,2CAAA,CAEA,sCACC,eAAA,CACA,kBAAA,CAEA,+CACC,YAAA,CACA,qBAAA,CACA,eAAA",sourcesContent:["\n.bridgetoken {\n\tborder-bottom: 1px solid var(--color-border);\n\n\t&__fields {\n\t\tmax-width: 600px;\n\t\tmargin-bottom: 10px;\n\n\t\t&__buttons {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\talign-items: end;\n\t\t}\n\t}\n}\n"],sourceRoot:""}]);const i=a},7005:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(1354),r=n.n(o),s=n(6314),a=n.n(s)()(r());a.push([e.id,"\n#bridgepersonal {\n\tpadding: 10px;\n}\n","",{version:3,sources:["webpack://./src/components/PersonalSettings.vue"],names:[],mappings:";AAgGA;CACC,aAAa;AACd",sourcesContent:["<template>\n\t<div id=\"bridgepersonal\">\n\t\t<h2>EUDAT B2SHARE Bridge</h2>\n\t\t<div v-if=\"loaded && servers.length\">\n\t\t\t<ul>\n\t\t\t\t<li v-for=\"server in servers\" :key=\"server.id\">\n\t\t\t\t\t<TokenEditor\n\t\t\t\t\t\t:id=\"parseInt(server.id)\"\n\t\t\t\t\t\t:name=\"server.name\"\n\t\t\t\t\t\t:url=\"server.publishUrl\"\n\t\t\t\t\t\t:token=\"getToken(server.id)\"\n\t\t\t\t\t\t@token-change=\"updateTokens\" />\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div v-if=\"loaded && servers.length === 0\">\n\t\t\t<p>No B2SHARE servers configured! </p>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport TokenEditor from './TokenEditor.vue'\n\nexport default {\n\tname: 'PersonalSettings',\n\tcomponents: {\n\t\tTokenEditor,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tservers: [],\n\t\t\ttokens: [],\n\t\t\tloaded: false,\n\t\t}\n\t},\n\n\t/**\n\t * Fetch list of servers when the component is loaded\n\t */\n\tasync mounted() {\n\t\tconst promise = this.loadServers()\n\t\tawait this.loadTokens() // ask for both and then wait\n\t\tawait promise\n\t\tthis.loaded = true\n\t},\n\n\tmethods: {\n\t\tloadServers() {\n\t\t\tconst urlPath = '/apps/b2sharebridge/servers?requesttoken=' + encodeURIComponent(OC.requestToken)\n\n\t\t\treturn axios\n\t\t\t\t.get(generateUrl(urlPath))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.debug('Loaded servers:')\n\t\t\t\t\tconsole.debug(response)\n\t\t\t\t\tthis.servers = response.data\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error('Fetching B2SHARE servers failed!')\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t})\n\t\t},\n\n\t\tloadTokens() {\n\t\t\tconst urlPath = '/apps/b2sharebridge/apitoken?requesttoken=' + encodeURIComponent(OC.requestToken)\n\n\t\t\treturn axios\n\t\t\t\t.get(generateUrl(urlPath))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.debug('Loaded tokens:')\n\t\t\t\t\tconsole.debug(response)\n\t\t\t\t\tthis.tokens = response.data\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error('Fetching B2SHARE tokens failed!')\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t})\n\t\t},\n\n\t\tgetToken(serverId) {\n\t\t\treturn this.tokens[serverId] || ''\n\t\t},\n\n\t\tupdateTokens() {\n\t\t\tthis.loadTokens()\n\t\t\tthis.$forceUpdate()\n\t\t},\n\t},\n}\n<\/script>\n\n<style>\n#bridgepersonal {\n\tpadding: 10px;\n}\n</style>\n"],sourceRoot:""}]);const i=a},7770:(e,t,n)=>{var o=n(3814),r=n(3751),s=n(641);const a={id:"bridgepersonal"},i={key:0},d={key:1};var l=n(6802),u=n(33);const c={class:"bridgetoken"},h={class:"bridgetoken__fields"},k=["href"],p={class:"bridgetoken__fields__buttons"};var v=n(2699);const g={name:"TokenEditor",components:{NcPasswordField:v.b9,NcButton:v.x1},props:{id:{required:!0,type:Number},name:{required:!0,type:String},url:{required:!0,type:String},token:{default:"",type:String}},emits:["token-change"],data(){return{mutable_token:this.token,helpertext:"",token_validated:null}},async mounted(){if(60===this.mutable_token.length){const e={requesttoken:OC.requesttoken,token:this.mutable_token,serverid:this.id};l.Ay.post((0,o.Jv)("/apps/b2sharebridge/apitoken"),e).then(()=>{console.info("Saved token!"),this.$emit("token-change",this.id),this.token_validated=!0}).catch(e=>{console.error("Could not save token"),console.debug(e),this.token_validated=!1})}},methods:{saveToken(){if(!this.canSave())return;if(60!==this.mutable_token.length)return void console.debug("token has wrong length!",this.mutable_token.length);const e={requesttoken:OC.requesttoken,token:this.mutable_token,serverid:this.id};l.Ay.post((0,o.Jv)("/apps/b2sharebridge/apitoken"),e).then(()=>{console.info("Saved token!"),this.$emit("token-change",this.id),this.token_validated=!0}).catch(e=>{console.error("Could not save token"),console.debug(e),this.token_validated=!1})},getHelperText(){return 60===this.mutable_token.length?this.token_validated?"Token saved and validated":"Server token validation failed! Please create a new token!":0===this.mutable_token.length?"Copy your token from b2share":"A token has 60 characters"},getSuccess(){return 60===this.mutable_token.length&&this.token_validated},getError(){return 0!==this.mutable_token.length&&!this.token_validated},deleteToken(){l.Ay.delete((0,o.Jv)("/apps/b2sharebridge/apitoken/"+this.id)).then(()=>{console.info("Deleted token!"),this.mutable_token="",this.token_validated=null,this.$emit("token-change",this.id)}).catch(e=>{console.error("Could not delete token"),console.debug(e)})},canSave(){return this.mutable_token!==this.token&&""!==this.mutable_token}}};var b=n(5072),m=n.n(b),A=n(7825),f=n.n(A),C=n(7659),T=n.n(C),_=n(5056),y=n.n(_),x=n(540),E=n.n(x),S=n(1113),w=n.n(S),O=n(3510),q={};q.styleTagTransform=w(),q.setAttributes=y(),q.insert=T().bind(null,"head"),q.domAPI=f(),q.insertStyleElement=E();m()(O.A,q);O.A&&O.A.locals&&O.A.locals;var P=n(6262);const B={name:"PersonalSettings",components:{TokenEditor:(0,P.A)(g,[["render",function(e,t,n,o,r,a){const i=(0,s.g2)("NcPasswordField"),d=(0,s.g2)("NcButton");return(0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("h3",null,(0,u.v_)(n.name),1),(0,s.Lk)("div",h,[(0,s.Lk)("a",{href:n.url+"/user"},(0,u.v_)(n.url),9,k),(0,s.bF)(i,{modelValue:r.mutable_token,"onUpdate:modelValue":[t[0]||(t[0]=e=>r.mutable_token=e),a.saveToken],label:"Token",placeholder:"Token",minlength:60,maxlength:60,success:a.getSuccess(),error:a.getError(),"helper-text":a.getHelperText(),onValid:a.saveToken},null,8,["modelValue","success","error","helper-text","onValid","onUpdate:modelValue"]),(0,s.Lk)("div",p,[(0,s.bF)(d,{variant:"error","aria-label":"Delete Token",onClick:a.deleteToken},{default:(0,s.k6)(()=>[...t[1]||(t[1]=[(0,s.eW)(" Delete Token ",-1)])]),_:1},8,["onClick"])])])])}],["__scopeId","data-v-20ea2ead"]])},data:()=>({servers:[],tokens:[],loaded:!1}),async mounted(){const e=this.loadServers();await this.loadTokens(),await e,this.loaded=!0},methods:{loadServers(){const e="/apps/b2sharebridge/servers?requesttoken="+encodeURIComponent(OC.requestToken);return l.Ay.get((0,o.Jv)(e)).then(e=>{console.debug("Loaded servers:"),console.debug(e),this.servers=e.data}).catch(e=>{console.error("Fetching B2SHARE servers failed!"),console.error(e)})},loadTokens(){const e="/apps/b2sharebridge/apitoken?requesttoken="+encodeURIComponent(OC.requestToken);return l.Ay.get((0,o.Jv)(e)).then(e=>{console.debug("Loaded tokens:"),console.debug(e),this.tokens=e.data}).catch(e=>{console.error("Fetching B2SHARE tokens failed!"),console.error(e)})},getToken(e){return this.tokens[e]||""},updateTokens(){this.loadTokens(),this.$forceUpdate()}}};var U=n(7005),R={};R.styleTagTransform=w(),R.setAttributes=y(),R.insert=T().bind(null,"head"),R.domAPI=f(),R.insertStyleElement=E();m()(U.A,R);U.A&&U.A.locals&&U.A.locals;const F=(0,P.A)(B,[["render",function(e,t,n,o,r,l){const u=(0,s.g2)("TokenEditor");return(0,s.uX)(),(0,s.CE)("div",a,[t[1]||(t[1]=(0,s.Lk)("h2",null,"EUDAT B2SHARE Bridge",-1)),r.loaded&&r.servers.length?((0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.servers,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id},[(0,s.bF)(u,{id:parseInt(e.id),name:e.name,url:e.publishUrl,token:l.getToken(e.id),onTokenChange:l.updateTokens},null,8,["id","name","url","token","onTokenChange"])]))),128))])])):(0,s.Q3)("",!0),r.loaded&&0===r.servers.length?((0,s.uX)(),(0,s.CE)("div",d,[...t[0]||(t[0]=[(0,s.Lk)("p",null,"No B2SHARE servers configured! ",-1)])])):(0,s.Q3)("",!0)])}]]);var I=n(3334);n.nc=btoa(OC.requestToken),n.p=(0,o.fg)("b2sharebridge","","js/");const j=(0,r.Ef)(F);j.mixin({methods:{t:I.t,n:I.n}}),j.mount("#b2sharebridge-personal-settings")}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={id:e,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.exports}o.m=t,e=[],o.O=(t,n,r,s)=>{if(!n){var a=1/0;for(u=0;u<e.length;u++){for(var[n,r,s]=e[u],i=!0,d=0;d<n.length;d++)(!1&s||a>=s)&&Object.keys(o.O).every(e=>o.O[e](n[d]))?n.splice(d--,1):(i=!1,s<a&&(a=s));if(i){e.splice(u--,1);var l=r();void 0!==l&&(t=l)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,r,s]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.e=()=>Promise.resolve(),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.j="settingspersonal",o.p="/apps/b2sharebridge/js/",(()=>{var e={settingspersonal:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,s,[a,i,d]=n,l=0;if(a.some(t=>0!==e[t])){for(r in i)o.o(i,r)&&(o.m[r]=i[r]);if(d)var u=d(o)}for(t&&t(n);l<a.length;l++)s=a[l],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(u)},n=self.webpackChunkb2sharebridge=self.webpackChunkb2sharebridge||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.nc=void 0;var r=o.O(void 0,["vendors"],()=>o(7770));r=o.O(r)})();
//# sourceMappingURL=b2sharebridge-settingspersonal.js.map?v=4f6028a56b02ccdd3b12