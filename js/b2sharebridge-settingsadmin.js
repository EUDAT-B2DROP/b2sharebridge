(()=>{"use strict";var e,t={5498:(e,t,r)=>{var s=r(3814),n=r(3751),i=r(641);const a={id:"admin-settings",class:"bridgeadmin"},l={id:"create"},o={key:0};var d=r(6802),u=r(33);const m={class:"bridgeserver"},c={class:"bridgeserver__input"},p={class:"bridgeserver__row bridgeserver__input__div"},v={key:0},h={class:"bridgeserver__buttons bridgeserver__row"};var b=r(2699),_=r(9542),g=r(4553),A=r(759),x=r(7460);const C={name:"ServerEditor",components:{NcButton:b.x1,NcSelect:b.EQ,NcTextField:b.v,NcCheckboxRadioSwitch:b.AO,UploadMultiple:A.A,FileUploadOutline:_.A,TagEditOutline:g.A,Web:x.A},props:{id:{type:Number,required:!0},name:{default:"",required:!1,type:String},publishurl:{default:"",required:!1,type:String},maxuploads:{default:5,type:Number},maxuploadfilesize:{default:512,type:Number},checkssl:{default:!1,type:Boolean},version:{default:()=>({id:2,label:"API-Version 2"}),type:Object}},emits:["server-change"],data(){return{mutable_name:this.name,mutable_publishUrl:this.publishurl,mutable_maxUploads:this.maxuploads,mutable_maxUploadFilesize:this.maxuploadfilesize,mutable_checkSsl:this.checkssl,mutable_version:this.version,version_options:{options:[{id:2,label:"API-Version 2"},{id:3,label:"API-Version 3"}]}}},computed:{getCheckboxName(){return"checkSsl"+(-1===this.id?"":this.id)}},methods:{resetProps(){this.mutable_name="",this.mutable_publishUrl="",this.mutable_maxUploads=5,this.mutable_maxUploadFilesize=512,this.mutable_checkSsl=!1,this.mutable_version={id:2,label:"API-Version 2"}},hasChanged(){return this.mutable_name!==this.name||this.mutable_publishUrl!==this.publishurl||this.mutable_maxUploads!==this.maxuploads||this.mutable_maxUploadFilesize!==this.maxuploadfilesize||this.mutable_checkSsl!==this.checkssl||this.mutable_version?.id!==this.version.id},saveServer(){const e={};this.id&&(e.id=this.id),e.name=this.mutable_name,e.publishUrl=this.stripTrailingSlash(this.mutable_publishUrl),this.mutable_publishUrl=e.publishUrl,e.maxUploads=this.mutable_maxUploads,e.maxUploadFilesize=this.mutable_maxUploadFilesize,e.checkSsl=this.mutable_checkSsl,e.version=this.mutable_version?.id??2,console.debug(JSON.stringify(e)),d.Ay.post((0,s.Jv)("/apps/b2sharebridge/server"),{server:e}).then(()=>{this.$emit("server-change",-1===this.id?0:this.id)}).catch(e=>{console.error("Could not save server"),console.debug(e)})},deleteServer(){this.id&&d.Ay.delete((0,s.Jv)("/apps/b2sharebridge/servers/"+this.id)).then(()=>{console.debug("Deleted server '"+this.name+"'"),this.$emit("server-change",this.id)}).catch(e=>{console.error("Could not delete server"),console.debug(e)})},stripTrailingSlash:e=>(e=e.trim()).endsWith("/")?e.slice(0,-1):e,updateVersion(e){void 0!==e?.id&&(this.mutable_version=e)}}};var S=r(5072),k=r.n(S),U=r(7825),f=r.n(U),y=r(7659),F=r.n(y),w=r(5056),E=r.n(w),z=r(540),V=r.n(z),O=r(1113),T=r.n(O),N=r(8370),B={};B.styleTagTransform=T(),B.setAttributes=E(),B.insert=F().bind(null,"head"),B.domAPI=f(),B.insertStyleElement=V();k()(N.A,B);N.A&&N.A.locals&&N.A.locals;var I=r(6262);const P={name:"AdminSettings",components:{ServerEditor:(0,I.A)(C,[["render",function(e,t,r,s,n,a){const l=(0,i.g2)("UploadMultiple"),o=(0,i.g2)("NcTextField"),d=(0,i.g2)("FileUploadOutline"),b=(0,i.g2)("NcCheckboxRadioSwitch"),_=(0,i.g2)("Web"),g=(0,i.g2)("TagEditOutline"),A=(0,i.g2)("NcSelect"),x=(0,i.g2)("NcButton");return(0,i.uX)(),(0,i.CE)("div",m,[(0,i.Lk)("div",c,[(0,i.Lk)("h4",null,(0,u.v_)(-1==r.id?"New Server":n.mutable_name),1),(0,i.bF)(o,{modelValue:n.mutable_maxUploads,"onUpdate:modelValue":t[0]||(t[0]=e=>n.mutable_maxUploads=e),label:"# of uploads per user at the same time","trailing-cutton-icon":"close","show-trailing-button":!0,success:parseInt(n.mutable_maxUploads)>0,error:isNaN(parseInt(n.mutable_maxUploads)),onTrailingButtonClick:t[1]||(t[1]=e=>n.mutable_maxUploads=5)},{icon:(0,i.k6)(()=>[(0,i.bF)(l,{size:20})]),_:1},8,["modelValue","success","error"]),(0,i.bF)(o,{modelValue:n.mutable_maxUploadFilesize,"onUpdate:modelValue":t[2]||(t[2]=e=>n.mutable_maxUploadFilesize=e),label:"MB, maximum filesize per upload","trailing-cutton-icon":"close","show-trailing-button":!0,success:parseInt(n.mutable_maxUploadFilesize)>0,error:isNaN(parseInt(n.mutable_maxUploadFilesize)),onTrailingButtonClick:t[3]||(t[3]=e=>n.mutable_maxUploadFilesize=512)},{icon:(0,i.k6)(()=>[(0,i.bF)(d,{size:20})]),_:1},8,["modelValue","success","error"]),(0,i.bF)(b,{id:a.getCheckboxName,modelValue:n.mutable_checkSsl,"onUpdate:modelValue":t[4]||(t[4]=e=>n.mutable_checkSsl=e)},{default:(0,i.k6)(()=>[...t[10]||(t[10]=[(0,i.eW)(" Check SSL ",-1)])]),_:1},8,["id","modelValue"]),(0,i.bF)(o,{modelValue:n.mutable_publishUrl,"onUpdate:modelValue":t[5]||(t[5]=e=>n.mutable_publishUrl=e),label:"Publish URL","trailing-cutton-icon":"close","show-trailing-button":!0,success:String(n.mutable_publishUrl).trim().startsWith("https://")&&!String(n.mutable_publishUrl).trim().endsWith("/"),error:String(n.mutable_publishUrl).length>0&&(!String(n.mutable_publishUrl).trim().startsWith("https://")||String(n.mutable_publishUrl).trim().endsWith("/")),onTrailingButtonClick:t[6]||(t[6]=e=>n.mutable_publishUrl="")},{icon:(0,i.k6)(()=>[(0,i.bF)(_,{size:20})]),_:1},8,["modelValue","success","error"]),(0,i.bF)(o,{modelValue:n.mutable_name,"onUpdate:modelValue":t[7]||(t[7]=e=>n.mutable_name=e),label:"Your Server Name","trailing-cutton-icon":"close","show-trailing-button":!0,success:String(n.mutable_name).length>0,onTrailingButtonClick:t[8]||(t[8]=e=>n.mutable_name="")},{icon:(0,i.k6)(()=>[(0,i.bF)(g,{size:20})]),_:1},8,["modelValue","success"]),(0,i.Lk)("div",p,[t[11]||(t[11]=(0,i.Lk)("p",null,"B2SHARE API-version:",-1)),3===n.mutable_version?.id?((0,i.uX)(),(0,i.CE)("p",v," (experimental!) ")):(0,i.Q3)("",!0),(0,i.bF)(A,(0,i.v6)(n.version_options,{modelValue:n.mutable_version,"onUpdate:modelValue":[t[9]||(t[9]=e=>n.mutable_version=e),a.updateVersion],class:"bridgeserver__input__div__select","label-outside":!0}),null,16,["modelValue","onUpdate:modelValue"])])]),(0,i.Lk)("div",h,[(0,i.bF)(x,{id:"save",disabled:!a.hasChanged(),onClick:a.saveServer},{default:(0,i.k6)(()=>[...t[12]||(t[12]=[(0,i.eW)(" Save ",-1)])]),_:1},8,["disabled","onClick"]),-1!==r.id?((0,i.uX)(),(0,i.Wv)(x,{key:0,onClick:a.deleteServer},{default:(0,i.k6)(()=>[...t[13]||(t[13]=[(0,i.eW)(" Delete ",-1)])]),_:1},8,["onClick"])):(0,i.Q3)("",!0),-1===r.id?((0,i.uX)(),(0,i.Wv)(x,{key:1,id:"reset",disabled:!a.hasChanged(),onClick:a.resetProps},{default:(0,i.k6)(()=>[...t[14]||(t[14]=[(0,i.eW)(" Reset ",-1)])]),_:1},8,["disabled","onClick"])):(0,i.Q3)("",!0)])])}],["__scopeId","data-v-17c5063a"]])},data:()=>({dummy_server:{id:-1,name:"",publishUrl:"",maxUploads:5,maxUploadFilesize:512,checkSsl:!1,version:{id:2,label:"API-Version 2"}},servers:[],loaded:!1}),async mounted(){await this.loadServers(),this.loaded=!0},methods:{loadServers(){const e="/apps/b2sharebridge/servers?requesttoken="+encodeURIComponent(OC.requestToken);return d.Ay.get((0,s.Jv)(e)).then(e=>{console.debug("Loaded servers:"),console.debug(e),this.servers=[],this.servers=this.servers.concat(e.data)}).catch(e=>{console.error("Fetching B2SHARE servers failed!"),console.error(e)})}}};var L=r(7902),R={};R.styleTagTransform=T(),R.setAttributes=E(),R.insert=F().bind(null,"head"),R.domAPI=f(),R.insertStyleElement=V();k()(L.A,R);L.A&&L.A.locals&&L.A.locals;const W=(0,I.A)(P,[["render",function(e,t,r,s,n,d){const u=(0,i.g2)("ServerEditor");return(0,i.uX)(),(0,i.CE)("div",a,[t[2]||(t[2]=(0,i.Lk)("h2",null,"EUDAT B2SHARE Bridge",-1)),(0,i.Lk)("div",l,[t[0]||(t[0]=(0,i.Lk)("h3",null,"Create a new Server:",-1)),(0,i.bF)(u,{id:n.dummy_server.id,name:n.dummy_server.name,publishurl:n.dummy_server.publishUrl,maxuploads:n.dummy_server.maxUploads,maxuploadfilesize:n.dummy_server.maxUploadFilesize,checkssl:n.dummy_server.checkSsl,version:n.dummy_server.version,onServerChange:d.loadServers},null,8,["id","name","publishurl","maxuploads","maxuploadfilesize","checkssl","version","onServerChange"])]),n.loaded&&n.servers.length?((0,i.uX)(),(0,i.CE)("div",o,[t[1]||(t[1]=(0,i.Lk)("h3",null,"Servers:",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.servers,e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id},[(0,i.bF)(u,{id:parseInt(e.id),name:e.name,publishurl:e.publishUrl,maxuploads:e.maxUploads,maxuploadfilesize:e.maxUploadFilesize,checkssl:1===e.checkSsl,version:{id:e.version,label:`API-Version ${e.version}`},onServerChange:d.loadServers},null,8,["id","name","publishurl","maxuploads","maxuploadfilesize","checkssl","version","onServerChange"])]))),128))])])):(0,i.Q3)("",!0)])}]]);var j=r(3334);r.nc=btoa(OC.requestToken),r.p=(0,s.fg)("b2sharebridge","","js/");const q=(0,n.Ef)(W);q.mixin({methods:{t:j.t,n:j.n}}),q.mount("#admin-settings")},7902:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(1354),n=r.n(s),i=r(6314),a=r.n(i)()(n());a.push([e.id,"\n.bridgeadmin {\n\tpadding: 10px;\n}\n\n","",{version:3,sources:["webpack://./src/components/AdminSettings.vue"],names:[],mappings:";AAiGA;CACC,aAAa;AACd",sourcesContent:['<template>\n\t<div id="admin-settings" class="bridgeadmin">\n\t\t<h2>EUDAT B2SHARE Bridge</h2>\n\t\t<div id="create">\n\t\t\t<h3>Create a new Server:</h3>\n\t\t\t<ServerEditor\n\t\t\t\t:id="dummy_server.id"\n\t\t\t\t:name="dummy_server.name"\n\t\t\t\t:publishurl="dummy_server.publishUrl"\n\t\t\t\t:maxuploads="dummy_server.maxUploads"\n\t\t\t\t:maxuploadfilesize="dummy_server.maxUploadFilesize"\n\t\t\t\t:checkssl="dummy_server.checkSsl"\n\t\t\t\t:version="dummy_server.version"\n\t\t\t\t@server-change="loadServers" />\n\t\t</div>\n\t\t<div v-if="loaded && servers.length">\n\t\t\t<h3>Servers:</h3>\n\t\t\t<ul>\n\t\t\t\t<li v-for="server in servers" :key="server.id">\n\t\t\t\t\t<ServerEditor\n\t\t\t\t\t\t:id="parseInt(server.id)"\n\t\t\t\t\t\t:name="server.name"\n\t\t\t\t\t\t:publishurl="server.publishUrl"\n\t\t\t\t\t\t:maxuploads="server.maxUploads"\n\t\t\t\t\t\t:maxuploadfilesize="server.maxUploadFilesize"\n\t\t\t\t\t\t:checkssl="server.checkSsl === 1"\n\t\t\t\t\t\t:version="{ id: server.version, label: `API-Version ${server.version}` }"\n\t\t\t\t\t\t@server-change="loadServers" />\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n// import {NcAppContent} from "@nextcloud/vue";\nimport axios from \'@nextcloud/axios\'\nimport { generateUrl } from \'@nextcloud/router\'\nimport ServerEditor from \'./ServerEditor.vue\'\n\nexport default {\n\tname: \'AdminSettings\',\n\tcomponents: {\n\t\t// NcAppContent,\n\t\tServerEditor,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tdummy_server: {\n\t\t\t\tid: -1,\n\t\t\t\tname: \'\',\n\t\t\t\tpublishUrl: \'\',\n\t\t\t\tmaxUploads: 5,\n\t\t\t\tmaxUploadFilesize: 512,\n\t\t\t\tcheckSsl: false,\n\t\t\t\tversion: {\n\t\t\t\t\tid: 2,\n\t\t\t\t\tlabel: \'API-Version 2\',\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tservers: [],\n\t\t\tloaded: false,\n\t\t}\n\t},\n\n\t/**\n\t * Fetch list of servers when the component is loaded\n\t */\n\tasync mounted() {\n\t\tawait this.loadServers()\n\t\tthis.loaded = true\n\t},\n\n\tmethods: {\n\t\tloadServers() {\n\t\t\tconst urlPath = \'/apps/b2sharebridge/servers?requesttoken=\' + encodeURIComponent(OC.requestToken)\n\n\t\t\treturn axios\n\t\t\t\t.get(generateUrl(urlPath))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.debug(\'Loaded servers:\')\n\t\t\t\t\tconsole.debug(response)\n\t\t\t\t\tthis.servers = []\n\t\t\t\t\tthis.servers = this.servers.concat(response.data)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(\'Fetching B2SHARE servers failed!\')\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t})\n\t\t},\n\t},\n}\n<\/script>\n\n<style>\n.bridgeadmin {\n\tpadding: 10px;\n}\n\n</style>\n'],sourceRoot:""}]);const l=a},8370:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(1354),n=r.n(s),i=r(6314),a=r.n(i)()(n());a.push([e.id,".bridgeserver[data-v-17c5063a]{border-bottom:1px solid var(--color-border)}.bridgeserver__input[data-v-17c5063a]{max-width:600px}.bridgeserver__input__div[data-v-17c5063a]{margin-top:6px}.bridgeserver__input__div p[data-v-17c5063a]{margin-inline-end:auto}.bridgeserver__input__div__select[data-v-17c5063a]{max-width:600px}.bridgeserver__row[data-v-17c5063a]{display:flex;flex-direction:row;align-items:center}.bridgeserver__buttons[data-v-17c5063a]{max-width:600px;margin-bottom:10px}.bridgeserver__buttons #save[data-v-17c5063a]{margin-inline-start:auto}","",{version:3,sources:["webpack://./src/components/ServerEditor.vue"],names:[],mappings:"AACA,+BACC,2CAAA,CAEA,sCACC,eAAA,CAEA,2CACC,cAAA,CAEA,6CACC,sBAAA,CAGD,mDACC,eAAA,CAKH,oCACC,YAAA,CACA,kBAAA,CACA,kBAAA,CAGD,wCACC,eAAA,CACA,kBAAA,CAEA,8CACC,wBAAA",sourcesContent:["\n.bridgeserver {\n\tborder-bottom: 1px solid var(--color-border);\n\n\t&__input {\n\t\tmax-width: 600px;\n\n\t\t&__div {\n\t\t\tmargin-top: 6px;\n\n\t\t\tp {\n\t\t\t\tmargin-inline-end: auto;\n\t\t\t}\n\n\t\t\t&__select {\n\t\t\t\tmax-width: 600px;\n\t\t\t}\n\t\t}\n\t}\n\n\t&__row {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t}\n\n\t&__buttons {\n\t\tmax-width: 600px;\n\t\tmargin-bottom: 10px;\n\n\t\t#save {\n\t\t\tmargin-inline-start: auto;\n\t\t}\n\t}\n}\n"],sourceRoot:""}]);const l=a}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={id:e,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.exports}s.m=t,e=[],s.O=(t,r,n,i)=>{if(!r){var a=1/0;for(u=0;u<e.length;u++){for(var[r,n,i]=e[u],l=!0,o=0;o<r.length;o++)(!1&i||a>=i)&&Object.keys(s.O).every(e=>s.O[e](r[o]))?r.splice(o--,1):(l=!1,i<a&&(a=i));if(l){e.splice(u--,1);var d=n();void 0!==d&&(t=d)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,n,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.e=()=>Promise.resolve(),s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j="settingsadmin",s.p="/apps/b2sharebridge/js/",(()=>{var e={settingsadmin:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var n,i,[a,l,o]=r,d=0;if(a.some(t=>0!==e[t])){for(n in l)s.o(l,n)&&(s.m[n]=l[n]);if(o)var u=o(s)}for(t&&t(r);d<a.length;d++)i=a[d],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(u)},r=self.webpackChunkb2sharebridge=self.webpackChunkb2sharebridge||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),s.nc=void 0;var n=s.O(void 0,["vendors"],()=>s(5498));n=s.O(n)})();
//# sourceMappingURL=b2sharebridge-settingsadmin.js.map?v=3e658f8a42deefaaec24